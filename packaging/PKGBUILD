# Maintainer: Proxy VM Wizard Team
pkgname=proxy-vm-wizard
pkgver=0.2.6
pkgrel=1
pkgdesc="GUI wizard for managing proxy gateway VMs with libvirt/QEMU"
arch=('x86_64')
url="https://github.com/proxyvmwizard/proxy-vm-wizard"
license=('MIT')
depends=('libvirt' 'qemu-base' 'virt-install' 'polkit')
makedepends=('rust' 'cargo')
optdepends=(
    'virt-manager: GUI for managing VMs'
    'dnsmasq: Required for libvirt networking'
)
source=("$pkgname-$pkgver.tar.gz::https://github.com/proxyvmwizard/$pkgname/archive/v$pkgver.tar.gz")
sha256sums=('SKIP')

build() {
    cd "$pkgname-$pkgver"
    cargo build --release --locked
}

check() {
    cd "$pkgname-$pkgver"
    cargo test --release --locked
}

package() {
    cd "$pkgname-$pkgver"
    
    # Binary
    install -Dm755 "target/release/proxy-vm-wizard" "$pkgdir/usr/bin/proxy-vm-wizard"
    
    # Desktop file
    install -Dm644 "assets/io.github.proxyvmwizard.ProxyVmWizard.desktop" \
        "$pkgdir/usr/share/applications/io.github.proxyvmwizard.ProxyVmWizard.desktop"
    
    # Icon
    install -Dm644 "assets/io.github.proxyvmwizard.ProxyVmWizard.svg" \
        "$pkgdir/usr/share/icons/hicolor/scalable/apps/io.github.proxyvmwizard.ProxyVmWizard.svg"
    
    # Metainfo
    install -Dm644 "assets/io.github.proxyvmwizard.ProxyVmWizard.metainfo.xml" \
        "$pkgdir/usr/share/metainfo/io.github.proxyvmwizard.ProxyVmWizard.metainfo.xml"
    
    # License
    install -Dm644 "LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
    
    # Documentation
    install -Dm644 "README.md" "$pkgdir/usr/share/doc/$pkgname/README.md"
}


